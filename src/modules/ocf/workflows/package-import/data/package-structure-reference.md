# OCF Package Structure Reference

This document defines the expected structure of an `.ocf.zip` package produced by the `package-export` workflow. Use this reference during package validation (step 02) to verify incoming packages.

---

## Archive Format

- **File extension:** `.ocf.zip`
- **Naming convention:** `{system_name}.ocf.zip`
- **Compression:** Standard ZIP format
- **Path format:** All paths inside the archive are relative (no absolute paths)

---

## Expected Archive Contents

### Root Level

The archive root contains workspace files and the setup prompt:

```
{system_name}.ocf.zip
├── {system_name}.setup.md      # Setup prompt (companion guide)
├── AGENTS.md                    # Agent directives (REQUIRED)
├── SOUL.md                      # Personality and identity (REQUIRED)
├── USER.md                      # User context and preferences (REQUIRED)
├── IDENTITY.md                  # Identity configuration (expected)
├── TOOLS.md                     # Tool definitions and policies (expected)
├── HEARTBEAT.md                 # Heartbeat/cron configuration (expected)
├── MEMORY.md                    # Memory backend configuration (expected)
├── BOOT.md                      # Boot sequence instructions (expected)
├── openclaw.json                # Configuration fragment (expected)
├── skills/                      # Skills directory (expected)
│   ├── SKILL.md                 # Skill definition(s)
│   └── {skill-name}.md          # Individual skill files
└── memory/                      # Memory directory (expected)
    └── {memory-files}           # Memory state files
```

---

## File Categories

### Required Files

These files MUST be present for a valid OCF package. Absence of any required file is an ERROR.

| File | Purpose |
|------|---------|
| `AGENTS.md` | Primary agent directive file. Contains agent identity, startup instructions, tool and skill bindings. May contain OCF metadata in YAML frontmatter. |
| `SOUL.md` | Agent personality, identity, and communication style definition. |
| `USER.md` | User context, preferences, and interaction patterns. |

### Expected Files

These files SHOULD be present in a well-formed package. Absence is a WARNING (not blocking).

| File | Purpose |
|------|---------|
| `IDENTITY.md` | Extended identity configuration beyond SOUL.md. |
| `TOOLS.md` | Tool definitions, policies, and access rules. |
| `HEARTBEAT.md` | Periodic task and cron-style configuration. |
| `MEMORY.md` | Memory backend setup and configuration. |
| `BOOT.md` | Boot sequence and initialization instructions. |
| `openclaw.json` | Configuration fragment for agents, bindings, and channels. |

### Setup Prompt

| File | Purpose |
|------|---------|
| `{system_name}.setup.md` | Companion setup guide generated by the export workflow. Contains step-by-step unpacking and activation instructions. Located at archive root level. |

### Directories

| Directory | Purpose |
|-----------|---------|
| `skills/` | Contains skill definition files (markdown). Each file defines a skill the agent can perform. |
| `memory/` | Contains memory state files. May include persistent memory, conversation history templates, or knowledge base files. |

---

## OCF Metadata

### Setup Prompt Frontmatter

The setup prompt (`{system_name}.setup.md`) contains YAML frontmatter with package metadata:

```yaml
---
ocf_version: '6.0.0-Beta'
system_name: 'example-agent'
created: '2026-02-13'
package_file: 'example-agent.ocf.zip'
template_origins: 'create-single-agent, configure-production-hardening'
---
```

| Field | Description |
|-------|-------------|
| `ocf_version` | OCF version used to create the package |
| `system_name` | Agent system identifier |
| `created` | ISO date when the package was created |
| `package_file` | Name of the archive file |
| `template_origins` | Comma-separated list of workflows/templates used during creation |

### AGENTS.md Frontmatter

The export workflow injects OCF metadata into the AGENTS.md YAML frontmatter:

```yaml
---
ocf_version: '6.0.0-Beta'
ocf_packaged: '2026-02-13'
ocf_system_name: 'example-agent'
ocf_template_origins: 'create-single-agent'
---
```

| Field | Description |
|-------|-------------|
| `ocf_version` | OCF version stamp |
| `ocf_packaged` | Date the workspace was packaged |
| `ocf_system_name` | System name assigned during export |
| `ocf_template_origins` | Templates used to create the original workspace |

---

## openclaw.json Structure

The configuration fragment follows the standard OpenClaw configuration schema:

```json
{
  "agents": {
    "list": [
      {
        "name": "agent-name",
        "description": "Agent description",
        "workspace": "./path-to-workspace",
        "enabled": true
      }
    ]
  },
  "bindings": [
    {
      "agent": "agent-name",
      "channel": "channel-name",
      "mode": "exclusive"
    }
  ],
  "channels": {
    "channel-name": {
      "type": "channel-type",
      "config": {}
    }
  }
}
```

### Merge Rules

When merging a package's `openclaw.json` into an existing configuration:

1. **agents.list[]** - Append new agent entries. If an agent with the same name exists, flag as conflict.
2. **bindings[]** - Append new binding entries. If a binding with the same agent+channel pair exists, flag as conflict.
3. **channels** - Add new channel definitions. If a channel with the same key exists, flag as conflict.
4. **Other keys** - Add any keys not present in existing config. If a key exists with a different value, flag as conflict.

---

## Validation Checklist

Use this checklist during package validation (step 02):

- [ ] Archive is a valid ZIP file with `.ocf.zip` extension
- [ ] All REQUIRED files are present (AGENTS.md, SOUL.md, USER.md)
- [ ] All present files are non-empty and readable
- [ ] No absolute paths exist inside the archive
- [ ] Setup prompt has valid YAML frontmatter (if present)
- [ ] AGENTS.md has OCF metadata in frontmatter (if present)
- [ ] openclaw.json is valid JSON (if present)
- [ ] Directory structure matches expected layout
